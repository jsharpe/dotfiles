#!/bin/bash

set -e

echo "==> Installing packages for Linux..."

# Detect if cargo is available
if ! command -v cargo &> /dev/null; then
    echo "==> Installing Rust/Cargo..."
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
    source "$HOME/.cargo/env"
fi

# Install fzf
if ! command -v fzf &> /dev/null; then
    echo "==> Installing fzf..."
    git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf
    ~/.fzf/install --all --no-bash --no-zsh
else
    echo "==> fzf is already installed ($(fzf --version))"
fi

# Install starship
if ! command -v starship &> /dev/null; then
    echo "==> Installing starship..."
    curl -sS https://starship.rs/install.sh | sh -s -- -y
else
    echo "==> starship is already installed ($(starship --version))"
fi

# Install jj (Jujutsu VCS)
if ! command -v jj &> /dev/null; then
    echo "==> Installing jj (Jujutsu VCS) via cargo..."
    cargo install --locked jj-cli
else
    echo "==> jj is already installed ($(jj --version))"
fi

echo "==> Linux package installation complete!"
